<?xml version="1.0" encoding="UTF-8"?>
<plugin id="cordova-plugin-geckoview-engine"
        version="1.2.0"
        xmlns="http://apache.org/cordova/ns/plugins/1.0"
        xmlns:android="http://schemas.android.com/apk/res/android">

    <name>Cordova GeckoView Engine</name>
    <description>Replaces Cordova's default Android WebView with Mozilla GeckoView (optimized size).</description>

    <platform name="android">

        <!-- Inject custom Gradle config: repos, GeckoView dep, ABI filters, Java 17, packaging -->
        <framework src="src/android/build.gradle"
                   custom="true"
                   type="gradleReference" />

        <!-- R8/ProGuard rules for GeckoView + Cordova -->
        <resource-file src="src/android/proguard-geckoview.pro"
                       target="app/proguard-geckoview.pro" />

        <!-- Engine Java source -->
        <source-file src="src/android/GeckoViewEngine.java"
                     target-dir="src/com/cordova/geckoview" />
        <source-file src="src/android/LocalHttpServer.java"
                     target-dir="src/com/cordova/geckoview" />

        <!-- Network security config to permit localhost cleartext for the embedded server -->
        <resource-file src="src/android/geckoview_network_security_config.xml"
                       target="res/xml/geckoview_network_security_config.xml" />
        <edit-config file="AndroidManifest.xml"
                     mode="merge"
                     target="/manifest/application">
            <application android:networkSecurityConfig="@xml/geckoview_network_security_config" />
        </edit-config>

    </platform>

    <js-module src="www/geckoview-engine.js" name="GeckoViewEngine">
        <clobbers target="window.GeckoViewEngine" />
    </js-module>

</plugin>
